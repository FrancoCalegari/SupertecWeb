<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard - Productos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f4f6f8; }
header { background: #222; color: #fff; padding: 1rem 2rem; }
h1 { margin: 0; }
.container { max-width: 1100px; margin: 2rem auto; }
table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px #0001; }
th, td { padding: 0.75rem; border-bottom: 1px solid #eee; text-align: left; }
th { background: #f0f0f0; }
img { max-width: 80px; border-radius: 4px; }
.actions button { margin-right: 0.5rem; }
.add-btn { background: #28a745; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; }
.edit-btn { background: #ffc107; color: #222; border: none; padding: 0.3rem 0.7rem; border-radius: 4px; cursor: pointer; }
.delete-btn { background: #dc3545; color: #fff; border: none; padding: 0.3rem 0.7rem; border-radius: 4px; cursor: pointer; }

/* Modal */
.modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: #fff; margin: 10% auto; padding: 2rem; border-radius: 8px; width: 400px; max-width: 90%; }
.modal-content form { display: flex; flex-direction: column; gap: 0.5rem; }
.modal-content input { padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
.modal-content button { margin-top: 1rem; padding: 0.5rem; border: none; border-radius: 4px; cursor: pointer; }
.modal-content .save-btn { background: #28a745; color: #fff; }
.modal-content .cancel-btn { background: #dc3545; color: #fff; }
</style>
</head>
<body>
<header>
    <h1>Admin Dashboard - Productos</h1>
</header>
<div class="container">
    <button class="add-btn" onclick="showForm()">Agregar Producto</button>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripción</th>
                <th>Precio</th>
                <th>Categoría</th>
                <th>Stock</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="productsTable"></tbody>
    </table>
</div>

<!-- Modal -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Agregar Producto</h3>
        <form id="productForm" onsubmit="saveProduct(event)">
            <input type="hidden" id="productId">
            <input type="text" id="name" placeholder="Nombre" required>
            <input type="text" id="img" placeholder="URL de imagen" required>
            <input type="text" id="description" placeholder="Descripción" required>
            <input type="number" id="precio" placeholder="Precio" required>
            <input type="text" id="categoria" placeholder="Categoría" required>
            <input type="number" id="stock" placeholder="Stock" required>
            <input type="text" id="marca" placeholder="Marca" required>
            <input type="text" id="modelo" placeholder="Modelo" required>
            <button type="submit" class="save-btn">Guardar</button>
            <button type="button" class="cancel-btn" onclick="hideForm()">Cancelar</button>
        </form>
    </div>
</div>

<script>
let productos = [];

// Cargar productos desde JSON
async function loadProductos() {
    try {
        const res = await fetch('/api/productos');
        productos = await res.json();
        renderTable();
    } catch(err) {
        alert('Error al cargar productos');
    }
}

function renderTable() {
    const tbody = document.getElementById('productsTable');
    tbody.innerHTML = '';
    productos.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${p.id}</td>
            <td><img src="${p.img}" alt="${p.name}"></td>
            <td>${p.name}</td>
            <td>${p.description}</td>
            <td>$${p.precio}</td>
            <td>${p.categoria}</td>
            <td>${p.stock}</td>
            <td>${p.marca}</td>
            <td>${p.modelo}</td>
            <td class="actions">
                <button class="edit-btn" onclick="editProduct(${p.id})">Editar</button>
                <button class="delete-btn" onclick="deleteProduct(${p.id})">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Mostrar modal
function showForm(edit = false) {
    document.getElementById('productModal').style.display = 'block';
    document.getElementById('modalTitle').textContent = edit ? 'Editar Producto' : 'Agregar Producto';
    if (!edit) document.getElementById('productForm').reset();
}

// Ocultar modal
function hideForm() {
    document.getElementById('productModal').style.display = 'none';
}

// Guardar producto
async function saveProduct(event) {
    event.preventDefault();
    const producto = {
        id: document.getElementById('productId').value || null,
        img: document.getElementById('img').value,
        name: document.getElementById('name').value,
        description: document.getElementById('description').value,
        precio: Number(document.getElementById('precio').value),
        categoria: document.getElementById('categoria').value,
        stock: Number(document.getElementById('stock').value),
        marca: document.getElementById('marca').value,
        modelo: document.getElementById('modelo').value
    };

    try {
        await fetch('/api/productos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(producto)
        });
        hideForm();
        loadProductos();
    } catch(err) {
        alert('Error al guardar producto');
    }
}

// Editar producto
function editProduct(id) {
    const p = productos.find(prod => prod.id === id);
    if (!p) return;
    showForm(true);
    document.getElementById('productId').value = p.id;
    document.getElementById('name').value = p.name;
    document.getElementById('img').value = p.img;
    document.getElementById('description').value = p.description;
    document.getElementById('precio').value = p.precio;
    document.getElementById('categoria').value = p.categoria;
    document.getElementById('stock').value = p.stock;
    document.getElementById('marca').value = p.marca;
    document.getElementById('modelo').value = p.modelo;
}

// Eliminar producto
async function deleteProduct(id) {
    if (!confirm('¿Seguro que deseas eliminar este producto?')) return;
    try {
        await fetch(`/api/productos/${id}`, { method: 'DELETE' });
        loadProductos();
    } catch(err) {
        alert('Error al eliminar producto');
    }
}

// Cerrar modal al hacer clic fuera del contenido
window.onclick = function(event) {
    const modal = document.getElementById('productModal');
    if (event.target == modal) hideForm();
}

// Inicializar tabla
loadProductos();
</script>
</body>
</html>
